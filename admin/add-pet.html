<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新增寵物 - 小基基寵物犬舍</title>
    <link rel="icon" type="image/png" href="../images/logo.png">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="admin-panel">
        <!-- 側邊欄 -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <img src="../images/logo.png" alt="小基基寵物犬舍">
                <h3>管理系統</h3>
            </div>
            <ul class="admin-menu">
                <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> 儀表板</a></li>
                <li><a href="pets.html"><i class="fas fa-dog"></i> 寵物管理</a></li>
                <li><a href="add-pet.html" class="active"><i class="fas fa-plus-circle"></i> 新增寵物</a></li>
                <li><a href="messages.html"><i class="fas fa-envelope"></i> 訊息管理</a></li>
                <li><a href="testimonials.html"><i class="fas fa-star"></i> 客戶評價</a></li>
                <li><a href="gallery.html"><i class="fas fa-images"></i> 相簿管理</a></li>
                <li><a href="announcements.html"><i class="fas fa-bullhorn"></i> 公告管理</a></li>
                <li><a href="site-settings.html"><i class="fas fa-cog"></i> 網站設定</a></li>
                <li><a href="admin-settings.html"><i class="fas fa-user-cog"></i> 管理員設定</a></li>
                <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> 登出</a></li>
            </ul>
        </aside>

        <!-- 主要內容 -->
        <main class="admin-content">
            <div class="admin-header">
                <h1>新增寵物</h1>
            </div>

            <div class="content-section">
                <form id="petForm" class="pet-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="petName">寵物名稱 *</label>
                            <input type="text" id="petName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="petBreed">品種 *</label>
                            <select id="petBreed" name="breed" required>
                                <option value="">請選擇品種</option>
                                <optgroup label="大型犬">
                                    <option value="黃金獵犬">黃金獵犬</option>
                                    <option value="邊境牧羊犬">邊境牧羊犬</option>
                                    <option value="哈士奇">哈士奇</option>
                                    <option value="拉布拉多">拉布拉多</option>
                                    <option value="鬆獅犬">鬆獅犬</option>
                                    <option value="巨型貴賓">巨型貴賓</option>
                                    <option value="薩摩耶">薩摩耶</option>
                                </optgroup>
                                <optgroup label="中型犬">
                                    <option value="柴犬">柴犬</option>
                                    <option value="柯基犬">柯基犬</option>
                                    <option value="法國鬥牛犬">法國鬥牛犬</option>
                                    <option value="巴哥犬">巴哥犬</option>
                                    <option value="米格魯">米格魯</option>
                                    <option value="查理士">查理士</option>
                                </optgroup>
                                <optgroup label="小型犬">
                                    <option value="比熊犬">比熊犬</option>
                                    <option value="狐狸犬">狐狸犬</option>
                                    <option value="長毛臘腸犬">長毛臘腸犬</option>
                                    <option value="短毛臘腸犬">短毛臘腸犬</option>
                                    <option value="傑克羅素">傑克羅素</option>
                                    <option value="狐狸博美">狐狸博美</option>
                                    <option value="西施犬">西施犬</option>
                                    <option value="雪納瑞">雪納瑞</option>
                                    <option value="騎士比熊">騎士比熊</option>
                                    <option value="可卡布">可卡布</option>
                                    <option value="瑪爾濟斯">瑪爾濟斯</option>
                                    <option value="貴賓">貴賓</option>
                                    <option value="約克夏">約克夏</option>
                                    <option value="博美">博美</option>
                                    <option value="瑪爾泰迪">瑪爾泰迪</option>
                                    <option value="吉娃娃">吉娃娃</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="petBirthdate">出生日期 *</label>
                            <input type="date" id="petBirthdate" name="birthdate" required onchange="calculateAge()">
                        </div>
                        <div class="form-group">
                            <label for="petAge">年齡</label>
                            <input type="text" id="petAge" name="age" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="petGender">性別 *</label>
                            <select id="petGender" name="gender" required>
                                <option value="">請選擇性別</option>
                                <option value="male">公犬</option>
                                <option value="female">母犬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="petColor">毛色 *</label>
                            <input type="text" id="petColor" name="color" placeholder="例：黑白色、三色" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="petCategory">犬型分類 *</label>
                            <select id="petCategory" name="category" required>
                                <option value="">請選擇犬型</option>
                                <option value="small">小型犬</option>
                                <option value="medium">中型犬</option>
                                <option value="large">大型犬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="petPrice">價格 (NT$) *</label>
                            <input type="number" id="petPrice" name="price" min="0" required>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="petDescription">描述 *</label>
                        <textarea id="petDescription" name="description" placeholder="請詳細描述寵物的個性、健康狀況、特色等..." required></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="petHealth">健康資訊</label>
                        <textarea id="petHealth" name="health" placeholder="疫苗接種情況、健康檢查紀錄等..."></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="petImages">上傳圖片</label>
                        <input type="file" id="petImages" name="images" multiple accept="image/png,.png" onchange="previewImages()">
                        <small style="color: #666;">
                            <i class="fas fa-info-circle"></i>
                            支援上傳 <strong>1-5張圖片</strong>，單一檔案大小不超過 <strong>2MB</strong><br>
                            <i class="fas fa-image"></i>
                            <strong>僅支援 PNG 格式</strong> | 第一張圖片將作為主要展示圖片
                        </small>
                        <div class="image-preview" id="imagePreview"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">儲存寵物資料</button>
                        <a href="pets.html" class="btn-cancel">取消</a>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script src="../js/api.js"></script>
    <script src="admin-auth.js"></script>
    <script src="admin-pets.js"></script>
    <script>
        // 品種與犬型的對應關係
        const breedToCategory = {
            // 大型犬
            '黃金獵犬': 'large',
            '邊境牧羊犬': 'large',
            '哈士奇': 'large',
            '拉布拉多': 'large',
            '鬆獅犬': 'large',
            '巨型貴賓': 'large',
            '薩摩耶': 'large',
            
            // 中型犬
            '柴犬': 'medium',
            '柯基犬': 'medium',
            '法國鬥牛犬': 'medium',
            '巴哥犬': 'medium',
            '米格魯': 'medium',
            '查理士': 'medium',
            
            // 小型犬
            '比熊犬': 'small',
            '狐狸犬': 'small',
            '長毛臘腸犬': 'small',
            '短毛臘腸犬': 'small',
            '傑克羅素': 'small',
            '狐狸博美': 'small',
            '西施犬': 'small',
            '雪納瑞': 'small',
            '騎士比熊': 'small',
            '可卡布': 'small',
            '瑪爾濟斯': 'small',
            '貴賓': 'small',
            '約克夏': 'small',
            '博美': 'small',
            '瑪爾泰迪': 'small',
            '吉娃娃': 'small'
        };

        // 圖片預覽功能
        function previewImages() {
            const input = document.getElementById('petImages');
            const preview = document.getElementById('imagePreview');

            // 清空之前的預覽
            preview.innerHTML = '';

            if (input.files && input.files.length > 0) {
                // 檢查圖片數量限制
                if (input.files.length > 5) {
                    alert('最多只能上傳5張圖片！');
                    input.value = '';
                    return;
                }

                // 顯示圖片數量提示
                const countInfo = document.createElement('div');
                countInfo.className = 'image-count-info';
                countInfo.innerHTML = `<i class="fas fa-images"></i> 已選擇 ${input.files.length} 張圖片 (最多5張)`;
                preview.appendChild(countInfo);

                // 創建預覽容器
                const previewContainer = document.createElement('div');
                previewContainer.className = 'image-preview-container';

                Array.from(input.files).forEach((file, index) => {
                    // 檢查檔案大小
                    if (file.size > 2 * 1024 * 1024) {
                        alert(`圖片 "${file.name}" 超過2MB限制！`);
                        return;
                    }

                    // 檢查檔案類型 - 僅支援 PNG
                    if (file.type !== 'image/png') {
                        alert(`檔案 "${file.name}" 不是 PNG 格式！請選擇 PNG 圖片檔案。`);
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-preview-item';

                        imageItem.innerHTML = `
                            <img src="${e.target.result}" alt="預覽圖片 ${index + 1}">
                            <div class="image-info">
                                <span class="image-name">${file.name}</span>
                                <span class="image-size">${(file.size / 1024).toFixed(1)} KB</span>
                                <span class="image-index">第 ${index + 1} 張</span>
                            </div>
                        `;

                        previewContainer.appendChild(imageItem);
                    };
                    reader.readAsDataURL(file);
                });

                preview.appendChild(previewContainer);
            }
        }

        // 當品種選擇改變時自動設定犬型分類
        document.addEventListener('DOMContentLoaded', function() {
            const breedSelect = document.getElementById('petBreed');
            const categorySelect = document.getElementById('petCategory');
            
            if (breedSelect && categorySelect) {
                breedSelect.addEventListener('change', function() {
                    const selectedBreed = this.value;
                    const category = breedToCategory[selectedBreed];
                    
                    if (category) {
                        categorySelect.value = category;
                        // 添加視覺提示
                        categorySelect.style.backgroundColor = '#e8f5e8';
                        setTimeout(() => {
                            categorySelect.style.backgroundColor = '';
                        }, 1000);
                    } else {
                        categorySelect.value = '';
                    }
                });
            }
        });
    </script>
</body>
</html>